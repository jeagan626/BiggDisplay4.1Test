#include <Arduino.h>
#include <U8g2lib.h>
const int diagPin = 38;
const int performancePin = 39;
const int LedPin = 13;
bool performanceState = false;
bool LedState = false;
int displayUpdateCounter = 0;
int u8g2Runtime = 0;
#define JboxIcon_width 100
#define JboxIcon_height 100
static unsigned const char JboxIcon_bits[] = {
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
   0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x01, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x90, 0x00, 0x00, 0x00, 0x00, 0x18, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0xa8, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa8, 0x00, 0x00, 0x00, 0x00, 0x07,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xdc, 0x00, 0x00, 0x00, 0x80,
   0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77, 0x00, 0x00, 0x00,
   0xc0, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfd, 0x00, 0x00,
   0x00, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x8f, 0xcf, 0x00,
   0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x67,
   0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa0,
   0xf2, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0xe0, 0xd3, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x20, 0xe9, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x20, 0x7d, 0x00, 0x00, 0x00, 0x60, 0x60, 0xff, 0xff, 0xff,
   0xff, 0xff, 0xdf, 0xa0, 0xdf, 0x00, 0x00, 0x00, 0x60, 0xe0, 0xff, 0xff,
   0xff, 0xff, 0xff, 0x1f, 0xe1, 0xce, 0x00, 0x00, 0x00, 0x60, 0x20, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x80, 0xe1, 0xea, 0x00, 0x00, 0x00, 0x60, 0x20,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xa1, 0xd7, 0x00, 0x00, 0x00, 0x60,
   0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xa1, 0xea, 0x00, 0x00, 0x00,
   0x60, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xa1, 0xf6, 0x00, 0x00,
   0x00, 0x60, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xa1, 0xdf, 0x00,
   0x00, 0x00, 0x60, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xe1, 0xfb,
   0x00, 0x00, 0x00, 0x60, 0x20, 0x00, 0x00, 0xe0, 0x01, 0x00, 0x80, 0xe1,
   0xed, 0x00, 0x00, 0x00, 0x60, 0x20, 0x00, 0x00, 0x60, 0x01, 0x00, 0x80,
   0xe1, 0xf7, 0x00, 0x00, 0x00, 0x60, 0x20, 0x00, 0x00, 0xe0, 0x01, 0x00,
   0x80, 0xe1, 0x7d, 0x00, 0x00, 0x00, 0x60, 0x20, 0x00, 0x00, 0xe0, 0x01,
   0x00, 0x80, 0xa1, 0x6e, 0x00, 0x00, 0x00, 0x60, 0x20, 0x00, 0x00, 0xe0,
   0x00, 0x00, 0x80, 0xa1, 0xc7, 0x00, 0x00, 0x00, 0x60, 0x20, 0x00, 0x00,
   0xe0, 0x01, 0x00, 0x80, 0xa1, 0xd3, 0x00, 0x00, 0x00, 0x60, 0x20, 0x00,
   0x00, 0xe0, 0x01, 0x00, 0x80, 0xa1, 0xda, 0x00, 0x00, 0x00, 0x60, 0x20,
   0x00, 0x00, 0xe0, 0x01, 0x00, 0x80, 0xa1, 0xbd, 0x00, 0x00, 0x00, 0x60,
   0x20, 0x00, 0x00, 0xa0, 0x01, 0x00, 0x80, 0xa1, 0x97, 0x00, 0x00, 0x00,
   0x60, 0x20, 0x00, 0x00, 0xa0, 0x01, 0x00, 0x80, 0xa1, 0x8d, 0x00, 0x00,
   0x00, 0x60, 0x20, 0x00, 0x00, 0x60, 0x01, 0x00, 0x80, 0xe1, 0xee, 0x00,
   0x00, 0x00, 0x60, 0x20, 0x00, 0x00, 0x60, 0x01, 0x00, 0x80, 0xe1, 0xb6,
   0x00, 0x00, 0x00, 0x60, 0x20, 0x00, 0x00, 0xe0, 0x01, 0x00, 0x80, 0xe1,
   0xfe, 0x00, 0x00, 0x00, 0x60, 0x20, 0x00, 0x00, 0xa0, 0x01, 0x00, 0x80,
   0xa1, 0xea, 0x00, 0x00, 0x00, 0x60, 0x20, 0x00, 0x1c, 0xa0, 0x01, 0x00,
   0x80, 0xa1, 0xad, 0x00, 0x00, 0x00, 0x60, 0x20, 0x00, 0x18, 0xe0, 0x01,
   0x00, 0x80, 0xa1, 0xe7, 0x00, 0x00, 0x00, 0x60, 0x20, 0x00, 0x1c, 0x60,
   0x01, 0x00, 0x80, 0xa1, 0xf3, 0x00, 0x00, 0x00, 0x60, 0x20, 0x00, 0x1c,
   0x60, 0x01, 0x00, 0x80, 0xa1, 0xea, 0x00, 0x00, 0x00, 0x60, 0x20, 0x00,
   0x24, 0xf0, 0x01, 0x00, 0x80, 0xa1, 0xcd, 0x00, 0x00, 0x00, 0x60, 0x20,
   0x00, 0xe8, 0xff, 0x00, 0x00, 0x80, 0xa1, 0xd6, 0x00, 0x00, 0x00, 0x60,
   0x20, 0x00, 0x70, 0x7f, 0x00, 0x00, 0x80, 0xe1, 0xcb, 0x00, 0x00, 0x00,
   0x60, 0x20, 0x00, 0x80, 0x1f, 0x00, 0x00, 0x80, 0xa1, 0xaa, 0x00, 0x00,
   0x00, 0x60, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xa1, 0x95, 0x00,
   0x00, 0x00, 0x60, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xe1, 0xba,
   0x00, 0x00, 0x00, 0x60, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xe1,
   0xaf, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
   0xe1, 0xd7, 0x00, 0x00, 0x00, 0x60, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x80, 0xa1, 0xad, 0x00, 0x00, 0x00, 0x60, 0x20, 0x10, 0x02, 0x00, 0x00,
   0x3c, 0xf1, 0x61, 0xd6, 0x00, 0x00, 0x00, 0x60, 0xe0, 0xff, 0xff, 0xff,
   0xff, 0xff, 0x7f, 0xe0, 0xf7, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0xa0, 0x7b, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0xa0, 0xff, 0x00, 0x00, 0x00, 0x60, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa0, 0xef, 0xde, 0x00, 0x00, 0x60,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa0, 0x36, 0xc0, 0x00, 0x00,
   0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa0, 0x0e, 0xe0, 0x00,
   0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x0e, 0xb8,
   0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa0, 0x05,
   0xfc, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60,
   0x01, 0xd6, 0x00, 0x00, 0xe8, 0xff, 0xff, 0xfb, 0xff, 0xff, 0xff, 0xff,
   0xbf, 0x00, 0xde, 0x00, 0x00, 0xe4, 0xff, 0xff, 0xff, 0xff, 0x7f, 0xff,
   0xff, 0x7e, 0x80, 0xff, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0xc0, 0xd7, 0x00, 0x80, 0x01, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0xe0, 0xd3, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0xf7, 0x00, 0xe0, 0xff, 0xff, 0xff,
   0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xdf, 0xfd, 0x00, 0x60, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0xdf, 0x00, 0x60, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x58, 0xf7, 0x00, 0x60,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0xad, 0x00,
   0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0xff,
   0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x98,
   0xd7, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0xf8, 0x6e, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0xf8, 0xff, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0xf8, 0xf6, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0xd8, 0xd3, 0x00, 0x60, 0x80, 0x0f, 0x00, 0x00, 0x00,
   0xfb, 0xef, 0xff, 0x07, 0xf8, 0xff, 0x00, 0x60, 0x80, 0x0e, 0x00, 0x00,
   0x00, 0xff, 0xff, 0xff, 0x07, 0x38, 0xbd, 0x00, 0x60, 0x80, 0x0f, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xd8, 0xff, 0x00, 0x60, 0x80, 0x09,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x77, 0x00, 0x60, 0x80,
   0x0f, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0x3b, 0x00, 0x60,
   0x00, 0x00, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x1d, 0x00,
   0x60, 0x00, 0x00, 0x0c, 0x70, 0xf8, 0x98, 0x01, 0x00, 0x00, 0xd8, 0x0f,
   0x00, 0x60, 0x00, 0x00, 0xcc, 0x71, 0x88, 0xd0, 0x00, 0x00, 0x00, 0x38,
   0x07, 0x00, 0x60, 0x00, 0x60, 0x0c, 0x90, 0xa8, 0x60, 0x00, 0x00, 0x00,
   0xf8, 0x03, 0x00, 0x60, 0x00, 0x60, 0x0c, 0x90, 0x88, 0xb0, 0x00, 0x00,
   0x00, 0xf8, 0x01, 0x00, 0x60, 0x00, 0xe0, 0x0f, 0xf0, 0xf8, 0x98, 0x01,
   0x00, 0x00, 0xd8, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x18, 0x00, 0x00, 0xe0, 0xff, 0xff, 0xff, 0xff,
   0xff, 0xff, 0xff, 0xff, 0xff, 0x1f, 0x00, 0x00, 0xe0, 0xff, 0xff, 0xff,
   0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00 };

U8G2_T6963_240X128_F_8080 u8g2(U8G2_R2, 2, 14, 7, 8, 6, 20, 21, 5, /*enable/wr=*/ 27 , /*cs/ce=(green jumper)*/ 26, /*dc=(Purple jumper)*/ 25, /*reset=*/24); // Connect RD (orange) with +5V, FS0 and FS1 with GND
elapsedMillis displayUpdate;
void setup() {
  // put your setup code here, to run once:
  pinMode(performancePin,OUTPUT);
  pinMode(diagPin,OUTPUT);
  pinMode(LedPin,OUTPUT);
  digitalWrite(LedPin,HIGH);
  u8g2.begin();
  //u8g2.setFlipMode(0);
  u8g2.setContrast(255);
  u8g2.clearBuffer();
  u8g2.drawXBM( 40, 10, JboxIcon_width, JboxIcon_height, JboxIcon_bits);
    //u8g2.drawXBM( 0, 30, ScRacing_width, ScRacing_height, ScRacing_bits);
    u8g2.setFont(u8g2_font_courR10_tr);
    u8g2.setFontPosBaseline(); // Set the font position to the bottom
    u8g2.drawStr(160,10,"J-Box");
    u8g2.drawStr(160,23,"Bootup");
    u8g2.sendBuffer();
    delay(2000);
   u8g2.setFont(u8g2_font_ncenB14_tr);
  // u8g2.drawStr(32,20,"Booting Up");
  // u8g2.sendBuffer();
}

void loop() {
  // put your main code here, to run repeatedly:
   performanceState = !performanceState;
  if(performanceState) digitalWriteFast(performancePin,HIGH);
  else digitalWriteFast(performancePin,LOW);
   if(displayUpdate > 50)
   {
      digitalWriteFast(diagPin,HIGH);
      elapsedMillis displayTime;
      u8g2.clearBuffer();
      u8g2.setCursor(0,50);
      u8g2.print("Updates:");
      u8g2.print(displayUpdateCounter);
      u8g2.setCursor(0,70);
      u8g2.print("UpdateTime:");
      u8g2.print(u8g2Runtime);
      u8g2.setCursor(0,100);
      u8g2.print("Execution Rate:");
      u8g2.print(1000/u8g2Runtime);
      u8g2.sendBuffer();
    u8g2Runtime = displayTime;
    //Serial.println(u8g2Runtime);
    digitalWriteFast(diagPin,LOW);
    displayUpdateCounter++;
    if(displayUpdateCounter > 100) {displayUpdateCounter = 0;}
    LedState = !LedState;
  if(LedState) digitalWriteFast(LedPin,HIGH);
  else digitalWriteFast(LedPin,LOW);

   }
}